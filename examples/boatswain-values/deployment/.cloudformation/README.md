# AWS CloudFormation Templates

boatswain has the ability to provision staging environments with AWS resources generated from CloudFormation templates. It can provision an EBS Volume to store MySQL data, ElastiCache, RDS, SQS â€” anything the app needs to function. CloudFormation templates are defined in the deployment/.cloudformation directory, invoked in servicemap definitions, and once provisioned will output an identifier to be dropped into the autogenerated values file and consumed by the staging app.

## Tracing a CloudFormation resource from template to autogenerated value

Let's use the cloudformation template `ebs-hydra-mysql.yaml`. It looks like this:

```yaml
# deployment/.cloudformation/ebs-hydra-mysql.yaml

AWSTemplateFormatVersion: 2010-09-09
Description: >-
  App: Hydra DB
  Create EBS Volume from a snapshot for the Hydra MySQL database. 
Metadata:
  Name: ebs-hydra-mydql
Resources:
  EBSVolume:
    Type: "AWS::EC2::Volume"
    Properties:
      AvailabilityZone: us-west-2a
      Encrypted: false
      Size: 100
      Tags:
        - Key: datasource
          Value: hydra
      VolumeType: standard
      SnapshotId: snap-12345
Outputs:
  AwsEbsVolumeId:
    Description: AwsEbsVolumeId
    Value: !Ref EBSVolume
 ```
 
 In order to make use of this template, we need to invoke this template _by file name_ in a servicemap definition. Like this:
 ```yaml
 # deployment/.servicemaps/staging.yaml
 
 ServiceMaps:
   - Name: hydra
     CloudFormationTemplate: ebs-hydra-mysql
 ```
 
This is the complete servicemap entry for hydra. It doesn't need to talk to any other services, and its database lives in the same deployment, so there's no `Test` or `Staging` services.

When boatswain pushes hydra to staging (`boatswain stage push hydra branch-name`) it will check for a `CloudFormationTemplate` value in the servicemap for hydra, look for that template by name in the .cloudformation directory, and create the CloudFormation stack with it using the AWS SDK. 
 
 ## Including a CloudFormation template in a servicemap
In order to make boatswain know about the CloudFormation template, it needs to be included in the service map for that app.





For more information on CloudFormation Templates, [visit the CloudFormation template page](https://aws.amazon.com/cloudformation/aws-cloudformation-templates/)
